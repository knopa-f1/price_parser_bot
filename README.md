# Price Parser Bot
Проект представляет собой Telegram-бота для парсинга данных + скрипт для парсинга цен, который можно запускать по расписанию.

После нажатия на кнопку "Загрузить цены" бот ожидает от пользователя файл формата .xls/.xlsx с колонками: 'title', 'url', 'xpath'.
Загруженный файл сохраняется в БД (SQLlite).

Модуль main_parser.py позволяет запускать по расписанию (по умолчанию каждые 30 секунд) парсинг загруженных путей к ценам, полученные цены после обработки загружаются в базу данных.
Также парсинг запускается после каждой загрузки цен пользователем.

В боте по кнопке "Посмотреть цены" будет выведена таблица со средними ценами товаров в разрезе сайтов.

## Установка и настройка

### Poetry
   
    Необходимо установить Poetry следуя инструкциям с официального сайта.

### Клонирование репозитория
   ```bash
   git clone git@github.com:knopa-f1/price_parser_bot.git
   cd price_parser_bot
   ```

### Установка зависимостей 
   
    Необходимо установить все зависимости проекта с помощью Poetry:
   ```bash
    poetry install
   ```

### Установка Playwright
    
   Необходимо установить Playwright и необходимые браузеры: Для корректной работы бота должен быть установлен Playwright и браузер Chromium:
   ```bash
   poetry run playwright install chromium
   ```
### Настройка окружения
   
   В  .env файле необходимо указать ключ Telegram-бота и путь к базе данных.

## Запуск скриптов

Для корректной работы необходимо запустить два скрипта в качестве сервисов
  ```bash
  poetry run python price_parser_bot/main_bot.py
  poetry run python price_parser_bot/main_parser.py
  ```

## Запуск тестов

Для запуска тестов необходимо вызвать команду:
   ```bash
    poetry run pytest
   ```

